<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 680" width="1100" height="680">
  <defs>
    <linearGradient id="nvGreen" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#76b900"/>
      <stop offset="100%" style="stop-color:#5a8f00"/>
    </linearGradient>
    <linearGradient id="cardBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a1a"/>
      <stop offset="100%" style="stop-color:#111"/>
    </linearGradient>
    <linearGradient id="gymBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1a2600"/>
      <stop offset="100%" style="stop-color:#0d1400"/>
    </linearGradient>
    <linearGradient id="trainBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#261a00"/>
      <stop offset="100%" style="stop-color:#140d00"/>
    </linearGradient>
    <linearGradient id="infBg" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#001a26"/>
      <stop offset="100%" style="stop-color:#000d14"/>
    </linearGradient>
    <filter id="shadow">
      <feDropShadow dx="0" dy="3" stdDeviation="6" flood-color="#000" flood-opacity="0.5"/>
    </filter>
    <marker id="arrowGreen" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#76b900"/>
    </marker>
    <marker id="arrowOrange" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ff9900"/>
    </marker>
    <marker id="arrowCyan" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#00ccff"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1100" height="680" rx="12" fill="#0a0a0a"/>
  <rect width="1100" height="3" fill="url(#nvGreen)"/>

  <!-- Title -->
  <text x="550" y="38" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="18" font-weight="700" fill="#fff" letter-spacing="1">System Architecture</text>
  <text x="550" y="56" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="11" fill="#76b900" letter-spacing="2">CONDUCTO GRID PRESSURE AUTOPILOT</text>

  <!-- ═══════════════════════════════════════ -->
  <!-- ROW 1: Agent Core (center stage) -->
  <!-- ═══════════════════════════════════════ -->

  <!-- Nemotron Agent Box -->
  <g transform="translate(340, 80)" filter="url(#shadow)">
    <rect width="420" height="120" rx="10" fill="url(#cardBg)" stroke="#76b900" stroke-width="1.5"/>
    <rect width="420" height="3" rx="1.5" fill="#76b900"/>
    <!-- Icon: brain -->
    <circle cx="60" cy="62" r="28" fill="none" stroke="#76b900" stroke-width="1.5" opacity="0.4"/>
    <circle cx="52" cy="52" r="4" fill="#76b900" opacity="0.8"/>
    <circle cx="68" cy="52" r="4" fill="#76b900" opacity="0.8"/>
    <circle cx="48" cy="68" r="3.5" fill="#76b900" opacity="0.7"/>
    <circle cx="60" cy="75" r="3.5" fill="#76b900" opacity="0.7"/>
    <circle cx="72" cy="68" r="3.5" fill="#76b900" opacity="0.7"/>
    <line x1="52" y1="52" x2="48" y2="68" stroke="#76b900" stroke-width="0.8" opacity="0.5"/>
    <line x1="68" y1="52" x2="72" y2="68" stroke="#76b900" stroke-width="0.8" opacity="0.5"/>
    <line x1="52" y1="52" x2="72" y2="68" stroke="#76b900" stroke-width="0.5" opacity="0.3"/>
    <line x1="48" y1="68" x2="60" y2="75" stroke="#76b900" stroke-width="0.8" opacity="0.5"/>
    <line x1="72" y1="68" x2="60" y2="75" stroke="#76b900" stroke-width="0.8" opacity="0.5"/>

    <text x="110" y="42" font-family="'Helvetica Neue', Arial, sans-serif" font-size="16" font-weight="700" fill="#fff">NemotronGridAgent</text>
    <text x="110" y="60" font-family="'Helvetica Neue', Arial, sans-serif" font-size="11" fill="#76b900">Nemotron-Mini-4B-Instruct  |  NIM API</text>
    <text x="110" y="82" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#666">System prompt + GridState context + reward history</text>
    <text x="110" y="98" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#666">Outputs: REDISPATCH | STORAGE | LOAD_SHAPE | TOPOLOGY</text>

    <!-- Badges -->
    <rect x="300" y="35" width="100" height="22" rx="11" fill="none" stroke="#76b900" stroke-width="1" opacity="0.5"/>
    <text x="350" y="50" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" font-weight="600" fill="#76b900" letter-spacing="1">agent.py</text>
    <rect x="300" y="65" width="100" height="22" rx="11" fill="none" stroke="#00ccff" stroke-width="1" opacity="0.5"/>
    <text x="350" y="80" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" font-weight="600" fill="#00ccff" letter-spacing="1">nim_client.py</text>
  </g>

  <!-- ═══════════════════════════════════════ -->
  <!-- ROW 2: Three pillars -->
  <!-- ═══════════════════════════════════════ -->

  <!-- LEFT: Grid Gym Environment -->
  <g transform="translate(30, 240)" filter="url(#shadow)">
    <rect width="320" height="200" rx="10" fill="url(#gymBg)" stroke="#76b900" stroke-width="1"/>
    <rect width="320" height="3" rx="1.5" fill="#76b900"/>
    <text x="160" y="30" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="14" font-weight="700" fill="#fff">NeMo Gym Environment</text>
    <text x="160" y="48" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#76b900">Physics-Based Grid Simulator</text>

    <!-- Grid mini-diagram -->
    <g transform="translate(40, 75)">
      <circle cx="0" cy="0" r="8" fill="#76b900" opacity="0.6"/>
      <circle cx="60" cy="0" r="8" fill="#76b900" opacity="0.6"/>
      <circle cx="120" cy="0" r="8" fill="#76b900" opacity="0.6"/>
      <circle cx="0" cy="50" r="8" fill="#76b900" opacity="0.6"/>
      <circle cx="60" cy="50" r="8" fill="#76b900" opacity="0.6"/>
      <circle cx="120" cy="50" r="8" fill="#76b900" opacity="0.6"/>
      <line x1="8" y1="0" x2="52" y2="0" stroke="#76b900" stroke-width="1.5" opacity="0.5"/>
      <line x1="68" y1="0" x2="112" y2="0" stroke="#76b900" stroke-width="1.5" opacity="0.5"/>
      <line x1="0" y1="8" x2="0" y2="42" stroke="#76b900" stroke-width="1.5" opacity="0.5"/>
      <line x1="60" y1="8" x2="60" y2="42" stroke="#76b900" stroke-width="1.5" opacity="0.5"/>
      <line x1="120" y1="8" x2="120" y2="42" stroke="#76b900" stroke-width="1.5" opacity="0.5"/>
      <line x1="8" y1="50" x2="52" y2="50" stroke="#76b900" stroke-width="1.5" opacity="0.5"/>
      <line x1="68" y1="50" x2="112" y2="50" stroke="#76b900" stroke-width="1.5" opacity="0.5"/>
    </g>

    <!-- Labels -->
    <text x="200" y="85" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">DC Power Flow Solver</text>
    <text x="200" y="100" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">6-bus / 14-bus Scenarios</text>
    <text x="200" y="115" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">Weather + Disturbances</text>
    <text x="200" y="130" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">Dynamic Growth Events</text>

    <!-- Files -->
    <rect x="30" y="155" width="80" height="20" rx="10" fill="none" stroke="#76b900" stroke-width="0.8" opacity="0.4"/>
    <text x="70" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#76b900">grid_env.py</text>
    <rect x="120" y="155" width="85" height="20" rx="10" fill="none" stroke="#76b900" stroke-width="0.8" opacity="0.4"/>
    <text x="162" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#76b900">power_flow.py</text>
    <rect x="215" y="155" width="75" height="20" rx="10" fill="none" stroke="#76b900" stroke-width="0.8" opacity="0.4"/>
    <text x="252" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#76b900">scenarios.py</text>
  </g>

  <!-- CENTER: Training Pipeline -->
  <g transform="translate(390, 240)" filter="url(#shadow)">
    <rect width="320" height="200" rx="10" fill="url(#trainBg)" stroke="#ff9900" stroke-width="1"/>
    <rect width="320" height="3" rx="1.5" fill="#ff9900"/>
    <text x="160" y="30" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="14" font-weight="700" fill="#fff">Online Training Pipeline</text>
    <text x="160" y="48" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#ff9900">VESSL A100 GPU  |  QLoRA Fine-Tuning</text>

    <!-- GPU chip mini icon -->
    <g transform="translate(60, 100)">
      <rect x="-20" y="-20" width="40" height="40" rx="4" fill="none" stroke="#ff9900" stroke-width="1.5" opacity="0.6"/>
      <rect x="-12" y="-12" width="24" height="24" rx="2" fill="#ff9900" opacity="0.15"/>
      <text x="0" y="4" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" font-weight="700" fill="#ff9900">A100</text>
      <!-- pins -->
      <line x1="-14" y1="-20" x2="-14" y2="-28" stroke="#ff9900" stroke-width="1.5" opacity="0.4"/>
      <line x1="0" y1="-20" x2="0" y2="-28" stroke="#ff9900" stroke-width="1.5" opacity="0.4"/>
      <line x1="14" y1="-20" x2="14" y2="-28" stroke="#ff9900" stroke-width="1.5" opacity="0.4"/>
      <line x1="-14" y1="20" x2="-14" y2="28" stroke="#ff9900" stroke-width="1.5" opacity="0.4"/>
      <line x1="0" y1="20" x2="0" y2="28" stroke="#ff9900" stroke-width="1.5" opacity="0.4"/>
      <line x1="14" y1="20" x2="14" y2="28" stroke="#ff9900" stroke-width="1.5" opacity="0.4"/>
    </g>

    <text x="200" y="85" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">4-bit QLoRA (r=16, alpha=32)</text>
    <text x="200" y="100" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">Real loss.backward() + optimizer.step()</text>
    <text x="200" y="115" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">SSH Tunnel: localhost:9090 → A100</text>
    <text x="200" y="130" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">Trace buffer → /train endpoint</text>

    <rect x="30" y="155" width="90" height="20" rx="10" fill="none" stroke="#ff9900" stroke-width="0.8" opacity="0.4"/>
    <text x="75" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#ff9900">peft_serve.py</text>
    <rect x="130" y="155" width="85" height="20" rx="10" fill="none" stroke="#ff9900" stroke-width="0.8" opacity="0.4"/>
    <text x="172" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#ff9900">vessl_runner.py</text>
    <rect x="225" y="155" width="70" height="20" rx="10" fill="none" stroke="#ff9900" stroke-width="0.8" opacity="0.4"/>
    <text x="260" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#ff9900">sft_train.py</text>
  </g>

  <!-- RIGHT: RAG + Memory -->
  <g transform="translate(750, 240)" filter="url(#shadow)">
    <rect width="320" height="200" rx="10" fill="url(#infBg)" stroke="#00ccff" stroke-width="1"/>
    <rect width="320" height="3" rx="1.5" fill="#00ccff"/>
    <text x="160" y="30" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="14" font-weight="700" fill="#fff">RAG + Memory Layer</text>
    <text x="160" y="48" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#00ccff">FAISS Vector Store  |  NIM Embeddings</text>

    <!-- DB icon -->
    <g transform="translate(60, 100)">
      <ellipse cx="0" cy="-14" rx="22" ry="8" fill="none" stroke="#00ccff" stroke-width="1.2" opacity="0.5"/>
      <line x1="-22" y1="-14" x2="-22" y2="14" stroke="#00ccff" stroke-width="1.2" opacity="0.5"/>
      <line x1="22" y1="-14" x2="22" y2="14" stroke="#00ccff" stroke-width="1.2" opacity="0.5"/>
      <ellipse cx="0" cy="14" rx="22" ry="8" fill="none" stroke="#00ccff" stroke-width="1.2" opacity="0.5"/>
      <ellipse cx="0" cy="0" rx="22" ry="8" fill="none" stroke="#00ccff" stroke-width="0.8" opacity="0.3" stroke-dasharray="3,2"/>
    </g>

    <text x="200" y="85" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">Grid topology documents</text>
    <text x="200" y="100" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">NERC/ISO operating rules</text>
    <text x="200" y="115" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">Historical incident reports</text>
    <text x="200" y="130" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#888">Operator feedback traces</text>

    <rect x="30" y="155" width="75" height="20" rx="10" fill="none" stroke="#00ccff" stroke-width="0.8" opacity="0.4"/>
    <text x="67" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#00ccff">retriever.py</text>
    <rect x="115" y="155" width="65" height="20" rx="10" fill="none" stroke="#00ccff" stroke-width="0.8" opacity="0.4"/>
    <text x="147" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#00ccff">store.py</text>
    <rect x="190" y="155" width="70" height="20" rx="10" fill="none" stroke="#00ccff" stroke-width="0.8" opacity="0.4"/>
    <text x="225" y="169" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#00ccff">indexer.py</text>
  </g>

  <!-- ═══════════════════════════════════════ -->
  <!-- ROW 3: Frontend + Traces -->
  <!-- ═══════════════════════════════════════ -->

  <!-- Frontend -->
  <g transform="translate(30, 480)" filter="url(#shadow)">
    <rect width="520" height="115" rx="10" fill="url(#cardBg)" stroke="#444" stroke-width="1"/>
    <rect width="520" height="3" rx="1.5" fill="#444"/>
    <text x="20" y="30" font-family="'Helvetica Neue', Arial, sans-serif" font-size="14" font-weight="700" fill="#fff">Real-Time Web Dashboard</text>
    <text x="20" y="48" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#888">FastAPI + WebSocket  |  Dynamic SVG Knowledge Graph + Chat Panel</text>
    <text x="20" y="72" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#555">Live power flows, voltage heatmap, agent actions, learning progress</text>
    <text x="20" y="88" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#555">Dynamic topology: nodes spawn outside network, camera auto-zooms</text>
    <rect x="350" y="25" width="80" height="20" rx="10" fill="none" stroke="#888" stroke-width="0.8" opacity="0.4"/>
    <text x="390" y="39" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#888">index.html</text>
    <rect x="440" y="25" width="65" height="20" rx="10" fill="none" stroke="#888" stroke-width="0.8" opacity="0.4"/>
    <text x="472" y="39" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#888">server.py</text>
  </g>

  <!-- Trace Buffer -->
  <g transform="translate(590, 480)" filter="url(#shadow)">
    <rect width="480" height="115" rx="10" fill="url(#cardBg)" stroke="#444" stroke-width="1"/>
    <rect width="480" height="3" rx="1.5" fill="#444"/>
    <text x="20" y="30" font-family="'Helvetica Neue', Arial, sans-serif" font-size="14" font-weight="700" fill="#fff">Trace Buffer + Reward Engine</text>
    <text x="20" y="48" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#888">JSONL append-only log  |  Multi-objective reward function</text>
    <text x="20" y="72" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#555">(state, action, outcome) tuples for SFT + RL training data</text>
    <text x="20" y="88" font-family="'Helvetica Neue', Arial, sans-serif" font-size="9" fill="#555">Reward: congestion + voltage + curtailment + cost + emissions + reliability</text>
    <rect x="310" y="25" width="80" height="20" rx="10" fill="none" stroke="#888" stroke-width="0.8" opacity="0.4"/>
    <text x="350" y="39" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#888">trace_buffer.py</text>
    <rect x="400" y="25" width="65" height="20" rx="10" fill="none" stroke="#888" stroke-width="0.8" opacity="0.4"/>
    <text x="432" y="39" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#888">reward.py</text>
  </g>

  <!-- ═══════════════════════════════════════ -->
  <!-- ARROWS -->
  <!-- ═══════════════════════════════════════ -->

  <!-- Agent → Gym (actions) -->
  <path d="M 440 200 L 440 210 Q 440 220 430 225 L 260 235" fill="none" stroke="#76b900" stroke-width="1.5" marker-end="url(#arrowGreen)" opacity="0.7"/>
  <text x="300" y="215" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#76b900" opacity="0.8">actions</text>

  <!-- Gym → Agent (state + reward) -->
  <path d="M 260 260 L 430 250 Q 440 248 440 240 L 440 204" fill="none" stroke="#76b900" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrowGreen)" opacity="0.5"/>
  <text x="300" y="265" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#76b900" opacity="0.6">state + reward</text>

  <!-- Agent → Training (traces) -->
  <path d="M 600 200 L 600 210 Q 600 220 590 225 L 560 235" fill="none" stroke="#ff9900" stroke-width="1.5" marker-end="url(#arrowOrange)" opacity="0.7"/>
  <text x="610" y="218" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#ff9900" opacity="0.8">traces</text>

  <!-- Training → Agent (updated LoRA) -->
  <path d="M 555 242 L 590 230 Q 600 226 600 218 L 600 204" fill="none" stroke="#ff9900" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrowOrange)" opacity="0.5"/>
  <text x="610" y="235" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#ff9900" opacity="0.6">LoRA weights</text>

  <!-- Agent → RAG (queries) -->
  <path d="M 700 200 L 820 235" fill="none" stroke="#00ccff" stroke-width="1.5" marker-end="url(#arrowCyan)" opacity="0.7"/>
  <text x="750" y="210" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#00ccff" opacity="0.8">query</text>

  <!-- RAG → Agent (context) -->
  <path d="M 825 240 L 705 204" fill="none" stroke="#00ccff" stroke-width="1.5" stroke-dasharray="4,3" marker-end="url(#arrowCyan)" opacity="0.5"/>
  <text x="765" y="230" font-family="'Helvetica Neue', Arial, sans-serif" font-size="8" fill="#00ccff" opacity="0.6">RAG context</text>

  <!-- Gym → Frontend (WebSocket) -->
  <path d="M 190 440 L 190 475" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrowGreen)" opacity="0.4"/>

  <!-- Agent → Trace Buffer -->
  <path d="M 650 200 Q 750 210 830 475" fill="none" stroke="#666" stroke-width="1" stroke-dasharray="3,3" opacity="0.3"/>

  <!-- Bottom label -->
  <text x="550" y="630" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="11" fill="#76b900" opacity="0.5" letter-spacing="3">CONTINUOUS ONLINE LEARNING — EVERY DECISION IMPROVES THE MODEL</text>
  <text x="550" y="660" text-anchor="middle" font-family="'Helvetica Neue', Arial, sans-serif" font-size="10" fill="#333" letter-spacing="1">main.py orchestrates the full loop  |  demo.py runs with heuristic agent + A100 training</text>
</svg>